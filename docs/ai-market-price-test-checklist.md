# AI 시세 예측 모듈 테스트 체크리스트

## 개요

AI 기반 시세 예측 모듈이 올바르게 작동하는지 검증하기 위한 테스트 체크리스트입니다.

---

## STEP 6-1: 단위 테스트 시나리오

### 테스트 1: estimateAIMarketPrice 기본 기능

**목적**: AI 시세 예측 함수가 올바르게 범위와 메타데이터를 반환하는지 확인

**입력 예시**:

```typescript
{
  appraised: 500_000_000, // 5억원
  area: 84, // 84㎡
  regionCode: "서울특별시 강남구",
  propertyType: "APT",
  yearBuilt: 2015
}
```

**기대 결과**:

- [ ] `min` 값이 존재하고 양수
- [ ] `max` 값이 존재하고 `min`보다 큼
- [ ] `confidence` 값이 0.55 (초기값)
- [ ] `volatility` 값이 0.06 (±6%)
- [ ] `model` 값이 "v0.1-ai-simulation"
- [ ] 범위가 ±5% ~ ±12% 사이에 있는지 확인
- [ ] 로그에 "🤖 [AI 시세 예측]" 메시지 출력 확인

**검증 방법**:

1. 브라우저 콘솔에서 매물 상세 페이지 접속
2. 콘솔 로그 확인: "🤖 [AI 시세 예측] AI 시뮬레이션 기반 범위 예측 시작"
3. 권리분석 실행 시 로그에서 AI 시세 범위 확인

---

### 테스트 2: 시나리오별 시세 선택 (calcAcquisitionAndMoS)

**목적**: 보수/중립/낙관 시나리오별로 올바른 시세 값이 선택되는지 확인

#### 시나리오 2-1: 보수적 시세 (conservative)

**입력**:

```typescript
{
  bidPrice: 350_000_000,
  rights: 10_000_000,
  capex: 5_000_000,
  eviction: 2_000_000,
  carrying: 0,
  contingency: 1_000_000,
  marketPriceRange: { min: 450_000_000, max: 550_000_000 },
  marketPriceScenario: "conservative",
  taxInput: { use: "RESIDENTIAL", price: 350_000_000 }
}
```

**기대 결과**:

- [ ] `marketPriceUsed` 값이 `marketPriceRange.min` (450,000,000원)과 일치
- [ ] `marketPriceScenario` 값이 "conservative"
- [ ] 안전마진이 중립 시나리오보다 작음 (더 보수적)
- [ ] 로그에 "💰 [총인수금액] 시나리오별 시세 적용: conservative" 메시지 확인

#### 시나리오 2-2: 중립 시세 (neutral) - 기본값

**입력**: 위와 동일하지만 `marketPriceScenario: "neutral"` 또는 미지정

**기대 결과**:

- [ ] `marketPriceUsed` 값이 `(min + max) / 2` (500,000,000원)과 일치
- [ ] `marketPriceScenario` 값이 "neutral"
- [ ] 로그에 "💰 [총인수금액] 시나리오별 시세 적용: neutral" 메시지 확인

#### 시나리오 2-3: 낙관적 시세 (optimistic)

**입력**: 위와 동일하지만 `marketPriceScenario: "optimistic"`

**기대 결과**:

- [ ] `marketPriceUsed` 값이 `marketPriceRange.max` (550,000,000원)과 일치
- [ ] `marketPriceScenario` 값이 "optimistic"
- [ ] 안전마진이 중립 시나리오보다 큼 (더 낙관적)
- [ ] 로그에 "💰 [총인수금액] 시나리오별 시세 적용: optimistic" 메시지 확인

---

### 테스트 3: 매물 유형별 계수 적용

**목적**: 매물 유형에 따라 시세 계수가 올바르게 적용되는지 확인

#### 테스트 3-1: 아파트 (APT)

**입력**: `propertyType: "APT"`

**기대 결과**:

- [ ] 시세가 감정가보다 약 5% 높게 계산됨 (계수 1.05)
- [ ] 로그에 "유형 계수: 1.050" 확인

#### 테스트 3-2: 오피스텔 (OFFICETEL)

**입력**: `propertyType: "OFFICETEL"`

**기대 결과**:

- [ ] 시세가 감정가보다 약 8% 낮게 계산됨 (계수 0.92)
- [ ] 로그에 "유형 계수: 0.920" 확인

#### 테스트 3-3: 빌라 (VILLA)

**입력**: `propertyType: "VILLA"`

**기대 결과**:

- [ ] 시세가 감정가보다 약 5% 낮게 계산됨 (계수 0.95)
- [ ] 로그에 "유형 계수: 0.950" 확인

---

### 테스트 4: 지역 계수 적용

**목적**: 지역별 계수가 올바르게 적용되는지 확인

#### 테스트 4-1: 강남/서초 지역

**입력**: `regionCode: "서울특별시 강남구"` 또는 `regionCode: "서울특별시 서초구"`

**기대 결과**:

- [ ] 지역 계수 1.08 적용
- [ ] 로그에 "지역 계수: 1.080" 확인

#### 테스트 4-2: 서울 기타 지역

**입력**: `regionCode: "서울특별시 종로구"`

**기대 결과**:

- [ ] 지역 계수 1.03 적용
- [ ] 로그에 "지역 계수: 1.030" 확인

#### 테스트 4-3: 기타 지역

**입력**: `regionCode: "경기도 수원시"`

**기대 결과**:

- [ ] 지역 계수 1.0 적용 (기본값)
- [ ] 로그에 "지역 계수: 1.000" 확인

---

## STEP 6-2: 통합 테스트 체크리스트

### 통합 테스트 1: 매물 상세 페이지 AI 시세 표시

**검증 항목**:

- [ ] 매물 상세 페이지 접속 시 사이드바에 "AI 예상 시세" 섹션 표시
- [ ] 시세 범위가 "min ~ max" 형식으로 표시
- [ ] 신뢰도가 백분율(%) 형식으로 표시
- [ ] 값이 숫자로 올바르게 포맷팅됨 (콤마 구분)

**실행 방법**:

1. 매물 목록에서 매물 선택
2. 매물 상세 페이지 접속
3. 사이드바 "핵심 요약" 섹션 확인

---

### 통합 테스트 2: 입찰 모달 AI 시세 표시

**검증 항목**:

- [ ] 입찰 결과에서 "AI 예상 시세" 카드 표시
- [ ] 시세 범위가 표시됨
- [ ] 신뢰도 정보가 표시됨
- [ ] 기존 "예상 시장가" 대신 "AI 예상 시세"로 변경되었는지 확인

**실행 방법**:

1. 매물 상세 페이지에서 "입찰하기" 클릭
2. 입찰가 입력 및 제출
3. 입찰 결과 모달에서 "AI 예상 시세" 카드 확인

---

### 통합 테스트 3: 권장 입찰가 계산에 AI 시세 반영

**검증 항목**:

- [ ] 권장 입찰가 범위가 AI 시세 기반으로 계산됨
- [ ] 최대 권장 입찰가가 AI 시세 중립값의 80% 이하로 계산됨
- [ ] 콘솔 로그에 "🤖 [AI 시세 연동] 권장 입찰가 계산에 AI 시세 적용" 메시지 확인

**실행 방법**:

1. 매물 상세 페이지 접속
2. 사이드바에서 권장 입찰가 범위 확인
3. 브라우저 콘솔에서 AI 시세 계산 로그 확인

---

### 통합 테스트 4: ROI 계산에 AI 시세 반영

**검증 항목**:

- [ ] 예상 수익률이 AI 시세 기반으로 계산됨
- [ ] ROI 값이 합리적인 범위 내에 있음 (-50% ~ +200%)
- [ ] 콘솔 로그에 AI 시세 계산 과정 확인

**실행 방법**:

1. 매물 상세 페이지 접속
2. 사이드바에서 예상 수익률 확인
3. 브라우저 콘솔에서 ROI 계산 로그 확인

---

### 통합 테스트 5: 권리분석 엔진 AI 시세 연동

**검증 항목**:

- [ ] 권리분석 실행 시 AI 시세가 자동으로 계산됨
- [ ] 안전마진 계산에 AI 시세가 사용됨
- [ ] 콘솔 로그에 "🤖 [AI 시세 연동] AI 시세 예측 시작" 메시지 확인
- [ ] 시나리오별 시세가 올바르게 적용됨 (기본값: neutral)

**실행 방법**:

1. 매물 상세 페이지 접속
2. "권리분석 리포트 보기" 클릭 또는 권리분석 자동 실행 대기
3. 브라우저 콘솔에서 AI 시세 연동 로그 확인

---

### 통합 테스트 6: 시나리오별 수익률 변화 확인

#### 시나리오 6-1: 보수적 시세 시나리오

**검증 방법**:

1. `rights-analysis-engine.ts`에서 `marketPriceScenario: "conservative"` 설정 (임시)
2. 권리분석 실행
3. 안전마진과 수익률이 가장 낮게 계산되는지 확인

**기대 결과**:

- [ ] 안전마진이 가장 작음
- [ ] 수익률이 가장 낮음

#### 시나리오 6-2: 중립 시세 시나리오 (기본)

**검증 방법**:

1. 기본 설정으로 권리분석 실행
2. 안전마진과 수익률 확인

**기대 결과**:

- [ ] 안전마진이 보수적과 낙관적 사이 값
- [ ] 수익률이 합리적인 범위

#### 시나리오 6-3: 낙관적 시세 시나리오

**검증 방법**:

1. `rights-analysis-engine.ts`에서 `marketPriceScenario: "optimistic"` 설정 (임시)
2. 권리분석 실행
3. 안전마진과 수익률이 가장 높게 계산되는지 확인

**기대 결과**:

- [ ] 안전마진이 가장 큼
- [ ] 수익률이 가장 높음

---

## STEP 6-3: 에러 처리 및 엣지 케이스

### 에러 케이스 1: 필수 파라미터 누락

**입력**: `{ appraised: 0 }` 또는 `{ appraised: undefined }`

**기대 결과**:

- [ ] 에러 발생 없이 기본값 처리
- [ ] 시세 범위가 최소값 보장 (예: ±5%)

---

### 에러 케이스 2: 음수 감정가

**입력**: `{ appraised: -1000000 }`

**기대 결과**:

- [ ] 시세 min/max 값이 0 이상으로 보정됨
- [ ] 경고 로그 출력 (선택사항)

---

### 에러 케이스 3: marketPriceRange 없이 기존 방식 사용

**입력**: `calcAcquisitionAndMoS({ ..., marketValue: 500_000_000 })`

**기대 결과**:

- [ ] 하위 호환성 유지: 기존 `marketValue` 파싱 로직 작동
- [ ] `marketPriceScenario`가 undefined로 반환

---

### 엣지 케이스 1: 매우 큰 감정가

**입력**: `{ appraised: 10_000_000_000 }` (100억원)

**기대 결과**:

- [ ] 계산이 오버플로우 없이 정상 작동
- [ ] 시세 범위가 ±5% ~ ±12% 사이에 유지

---

### 엣지 케이스 2: 매우 작은 감정가

**입력**: `{ appraised: 10_000_000 }` (1천만원)

**기대 결과**:

- [ ] 시세 범위가 최소 범위(±5%) 보장
- [ ] 계산 정확도 유지

---

## STEP 6-4: 성능 및 로그 검증

### 성능 검증

- [ ] 매물 상세 페이지 로드 시간이 기존 대비 크게 증가하지 않음 (< 500ms 추가)
- [ ] AI 시세 계산이 100ms 이내 완료
- [ ] 메모리 누수 없음 (반복 접속 시 메모리 증가 확인)

### 로그 검증

- [ ] 모든 AI 시세 계산 과정에 로그 기록됨
- [ ] 로그 형식이 "이모지 + [카테고리] + 설명" 형식 준수
- [ ] 에러 발생 시 적절한 에러 로그 출력

---

## 검증 완료 체크리스트

### 기본 기능

- [ ] STEP 6-1 모든 테스트 통과
- [ ] STEP 6-2 모든 통합 테스트 통과
- [ ] STEP 6-3 에러 처리 확인 완료
- [ ] STEP 6-4 성능 및 로그 확인 완료

### UI 표시

- [ ] 매물 상세 페이지 사이드바에 AI 시세 표시
- [ ] 입찰 모달에 AI 시세 범위 표시
- [ ] 신뢰도 정보 표시

### 계산 정확도

- [ ] 권장 입찰가가 AI 시세 기반으로 계산됨
- [ ] ROI가 AI 시세 기반으로 계산됨
- [ ] 안전마진이 시나리오별로 다르게 계산됨

---

## 테스트 실행 방법

1. **브라우저 콘솔 확인**:

   - Chrome DevTools (F12) 열기
   - Console 탭에서 로그 확인
   - "🤖 [AI 시세 예측]", "💰 [총인수금액]" 등의 로그 검색

2. **매물 생성 및 테스트**:

   - 개발자 모드 활성화
   - 매물 생성
   - 각 테스트 시나리오별로 검증

3. **네트워크 탭 확인**:
   - Network 탭에서 API 호출 확인
   - 불필요한 중복 호출 없음 확인

---

## 참고사항

- 모든 테스트는 실제 브라우저 환경에서 실행 필요
- 테스트 데이터는 실제 매물 데이터 사용 권장
- 로그는 브라우저 콘솔에서 확인 가능
- 개발자 모드 활성화 시 더 많은 디버그 정보 확인 가능
