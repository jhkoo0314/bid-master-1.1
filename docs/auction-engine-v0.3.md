# profit-analysis-v0.3.md  
> **ëª©ì **: v0.2 ì—”ì§„ì— ì´ì–´ **ìˆ˜ìµ ë¶„ì„(Profit Layer)** ì„ ì •ì‹ ëª¨ë“ˆë¡œ ì¶”ê°€í•˜ì—¬, **ë§¤ê°Â·ì„ëŒ€Â·ë ˆë²„ë¦¬ì§€Â·IRRÂ·ë¯¼ê°ë„ ë¶„ì„ì„ í¬í•¨í•œ íˆ¬ì ì„±ê³¼ í‰ê°€**ë¥¼ ì§€ì›í•œë‹¤.  
> **ë²„ì „ ë‹¨ê³„**: `v0.3` â€” ê³„ì‚° ëª¨ë¸ ë„ì… + Report UI ì„¤ê³„ + ì—”ì§„ í†µí•© ì¤€ë¹„  
> **ëŒ€ìƒ íŒŒì¼ êµ¬ì¡°**: `src/lib/profit/` + `src/components/report/ProfitAnalysisReport.tsx`  

---

## 0. ë³€ê²½ ìš”ì•½ (v0.2 â†’ v0.3)

| í•­ëª© | v0.2 | v0.3 |
|-------|------|------|
| ìˆ˜ìµ ê³„ì‚° | FMV ëŒ€ë¹„ ë‹¨ìˆœ ë§ˆì§„ ê³„ì‚° | ë§¤ê°/ì„ëŒ€/ë ˆë²„ë¦¬ì§€/IRR í¬í•¨í•œ ë³µí•© ìˆ˜ìµ ë¶„ì„ |
| Exit ê°€ì • | ë‹¨ì¼ Exit ê°€ê²© | ë³´ìˆ˜Â·ì¤‘ë¦½Â·ë‚™ê´€ 3ì‹œë‚˜ë¦¬ì˜¤ (FMV ê¸°ë°˜ Â±í¸ì°¨) |
| ë ˆë²„ë¦¬ì§€(ëŒ€ì¶œ) ì˜í–¥ | ì—†ìŒ | LTV 0% / 50% / 70% ì¼€ì´ìŠ¤ ë¹„êµ |
| IRR ê³„ì‚° | ì—†ìŒ | 6/12/24ê°œì›” ë³´ìœ  ê¸°ê°„ë³„ IRR ê³„ì‚° |
| ë¯¼ê°ë„ ë¶„ì„ | ì—†ìŒ | ë§¤ê°ê°€ Â±5% ë³€í™”ìœ¨ ëŒ€ë¹„ ìˆ˜ìµë¥  ë³€í™” |
| ìœ„í—˜ì¡°ì •ìˆ˜ìµë¥ (RAR) | ì—†ìŒ | riskFlags ê¸°ë°˜ ê°€ì¤‘ì¹˜ ì ìš© |
| ë¦¬í¬íŠ¸ UI | ê²½ë§¤/ê¶Œë¦¬/ëª…ì„¸ì„œ ë¶„ë¦¬ | **ìˆ˜ìµë¶„ì„ ë¦¬í¬íŠ¸(ì‹ ê·œ)** ìƒì„± |

---

## 1. Profit Layer ì±…ì„ ì •ì˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ auction-engine.ts            â”‚
â”‚  â”œ valuation                 â”‚
â”‚  â”œ rights                    â”‚
â”‚  â”œ costs                     â”‚
â”‚  â”œ profit  â† (v0.3 ì‹ ê·œ í™•ì¥)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### profit ë ˆì´ì–´ê°€ ë°˜í™˜í•˜ëŠ” ìµœì¢… ë°ì´í„° êµ¬ì¡°:
```ts
export interface ProfitAnalysisResult {
  base: BaseProfit;                // ê¸°ì¡´ FMV vs ì´ì¸ìˆ˜ê¸ˆì•¡ ë¹„êµ
  exitScenarios: ExitScenario[];   // 3ë‹¨ê³„ ë§¤ê°ê°€ ì‹œë‚˜ë¦¬ì˜¤
  leverageCases: LeverageCase[];   // LTVë³„ ìˆ˜ìµë¥  ë³€í™”
  irr: IRRResult[];                // ë³´ìœ ê¸°ê°„ë³„ IRR ê³„ì‚°
  rental?: RentalYieldResult;      // (ì„ íƒ) ì„ëŒ€ìˆ˜ìµ ë¶„ì„
  sensitivity: SensitivityResult;  // ë¯¼ê°ë„ ë¶„ì„
  riskAdjusted: RiskAdjustedReturn;// ìœ„í—˜ì¡°ì • ìˆ˜ìµë¥  (RAR)
  notes?: string[];
}
```

---

## 2. ë°ì´í„° ëª¨ë¸ ì •ì˜

### 2.1 Base Profit (FMV ê¸°ì¤€ ì†ìµ)

```ts
interface BaseProfit {
  totalAcquisition: number; // v0.2 ë™ì¼
  fmv: number;
  margin: number;           // fmv - totalAcquisition
  marginRate: number;       // margin / fmv
}
```

---

### 2.2 Exit ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë¸ (ë³´ìˆ˜/ì¤‘ë¦½/ë‚™ê´€)

```ts
interface ExitScenario {
  label: "ë³´ìˆ˜" | "ì¤‘ë¦½" | "ë‚™ê´€";
  exitPrice: number;             // fmv -5% / fmv / fmv +5%
  margin: number;                // exit - totalAcquisition
  marginRate: number;
}
```

---

### 2.3 ë ˆë²„ë¦¬ì§€(LTV) ëª¨ë¸

```ts
interface LeverageCase {
  ltv: number;                   // 0 | 0.5 | 0.7
  equity: number;                // ìê¸°ìë³¸ = totalAcquisition - loan
  costOfDebt: number;            // ì´ìë¹„ìš© (ì—° 5% ê°€ì •)
  exitProfit: number;            // exitPrice - totalAcquisition - interest
  roe: number;                   // exitProfit / equity
}
```

---

### 2.4 IRR ëª¨ë¸

```ts
interface IRRResult {
  holdMonths: number;            // 6 | 12 | 24
  irr: number;                   // ë‚´ë¶€ìˆ˜ìµë¥  (%)
}
```

IRR ê³„ì‚° ê·œì¹™:
```
íˆ¬ìê¸ˆ = equity
Exit íšŒìˆ˜ê¸ˆ = exitProfit + equity
ê¸°ê°„ = months / 12
```

---

### 2.5 ì„ëŒ€ìˆ˜ìµ ë¶„ì„ (ì„ íƒì )

```ts
interface RentalYieldResult {
  noi: number;                   // ì—° ìˆœì˜ì—…ì†Œë“ = ì„ëŒ€ë£Œ - ìš´ì˜ë¹„
  capRate: number;               // NOI / ì·¨ë“ê°€
  dscr: number;                  // NOI / ì—°ê°„ ì´ì
  cashFlow: number;              // NOI - ì´ì
}
```

---

### 2.6 ìœ„í—˜ì¡°ì • ìˆ˜ìµë¥  (RAR)

```ts
interface RiskAdjustedReturn {
  rawReturn: number;             // ê¸°ë³¸ ìˆ˜ìµë¥ 
  riskScore: number;             // riskFlags ê¸°ë°˜ (0~1)
  adjustedReturn: number;        // raw * (1 - riskScore)
}
```

---

## 3. ê³„ì‚° ëª¨ë¸ ìƒì„¸

### 3.1 Exit Price ì‹œë‚˜ë¦¬ì˜¤ ê³µì‹
```
ë³´ìˆ˜  = FMV Ã— 0.95
ì¤‘ë¦½  = FMV Ã— 1.00
ë‚™ê´€  = FMV Ã— 1.05
(ì¶”í›„ ì„¤ì •ê°’ ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥)
```

### 3.2 ë ˆë²„ë¦¬ì§€ ê³µì‹
```
loan = totalAcquisition Ã— LTV
equity = totalAcquisition - loan
interest = loan Ã— ì—°ì´ìœ¨ Ã— (ë³´ìœ ê°œì›”/12)
roe = (exitProfit - interest) / equity
```

### 3.3 IRR ê³µì‹
```
IRR = (Exit / Equity)^(1/ê¸°ê°„) - 1
```

### 3.4 ë¯¼ê°ë„ ë¶„ì„
```
exitPrice Â± 5% ë³€í™” â†’ marginRate ë³€í™” ë¹„êµ
```

### 3.5 ìœ„í—˜ì¡°ì • ìˆ˜ìµë¥ 
```
riskScore = riskFlags.length Ã— 0.05  (caps at 0.3)
RAR = marginRate Ã— (1 - riskScore)
```

---

## 4. UI ì„¤ê³„ (ProfitAnalysisReport)

ğŸ“Œ **ë¦¬í¬íŠ¸ 6ì„¹ì…˜ êµ¬ì„±**

| ì„¹ì…˜ | ë‚´ìš© |
|-------|------|
| 1. ê°œìš” | ì´íˆ¬ìê¸ˆ / FMV ëŒ€ë¹„ ìˆ˜ìµ ìš”ì•½ ì¹´ë“œ |
| 2. Exit 3ë‹¨ê³„ ë¹„êµ | ë³´ìˆ˜/ì¤‘ë¦½/ë‚™ê´€ í…Œì´ë¸” or ë§‰ëŒ€ê·¸ë˜í”„ |
| 3. ë ˆë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ | LTV 0/50/70% ë¹„êµ ì¹´ë“œ |
| 4. IRR | 6/12/24M ì„ í˜• ê·¸ë˜í”„ ë˜ëŠ” í‘œ |
| 5. ì„ëŒ€ìˆ˜ìµ | NOI / CAP / DSCR / ì—°í˜„ê¸ˆíë¦„ |
| 6. ìœ„í—˜ì¡°ì •ìˆ˜ìµë¥  | RiskFlags ìš”ì•½ + RAR (%) |

---

### ë¦¬í¬íŠ¸ ì˜ˆì‹œ êµ¬ì¡° (ìš”ì•½ UI)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° ìˆ˜ìµë¶„ì„ ë¦¬í¬íŠ¸ (v0.3)   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ì´íˆ¬ìê¸ˆ: 536,000,000ì›     â”‚
â”‚ FMV ëŒ€ë¹„ ë§ˆì§„: +14.2%       â”‚
â”‚ ìœ„í—˜ì¡°ì •ìˆ˜ìµë¥ : +11.9%      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ [EXIT ì‹œë‚˜ë¦¬ì˜¤ ì¹´ë“œ 3ê°œ]     â”‚
â”‚ [ë ˆë²„ë¦¬ì§€ ROI ë¹„êµ]          â”‚
â”‚ [IRR í‘œ]                     â”‚
â”‚ [ì„ëŒ€ìˆ˜ìµ ì„¹ì…˜]              â”‚
â”‚ [ìœ„í—˜ì¡°ì • ìˆ˜ìµ ìš”ì•½]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ì ìš© ë‹¨ê³„ ì²´í¬ë¦¬ìŠ¤íŠ¸

| ë‹¨ê³„ | ë‚´ìš© | ìƒíƒœ |
|-------|------|------|
| 1 | v0.3 Profit ë°ì´í„° ëª¨ë¸ ì •ì˜ | âœ… ì™„ë£Œ |
| 2 | `src/lib/profit/engine.ts` ìƒì„± | â³ ë‹¤ìŒ ë‹¨ê³„ |
| 3 | `auction-engine.ts` í†µí•© (profit ë ˆì´ì–´ ì¶”ê°€) | ì´í›„ ì§„í–‰ |
| 4 | `ProfitAnalysisReport.tsx` UI ìƒì„± | ì´í›„ ì§„í–‰ |
| 5 | í…ŒìŠ¤íŠ¸ ë°ì´í„° 5ì¢… ìƒì„± | ì´í›„ ì§„í–‰ |
| 6 | UI ëª¨ë‹¬ ì—°ê²° (ì…ì°°ëª¨ë‹¬ & ìƒì„¸í˜ì´ì§€) | ì´í›„ ì§„í–‰ |

---

## 6. TODO (ê°œë°œ ê´€ì )

```
[ ] profit-engine.ts ìƒì„±
[ ] auction-engine.tsì—ì„œ profit ë ˆì´ì–´ ë³‘í•©
[ ] LTV/IRR ê³„ì‚° ìœ í‹¸ë¦¬í‹° ìƒì„±
[ ] ìˆ˜ìµë¶„ì„ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ ìƒì„±
[ ] Dummy í…ŒìŠ¤íŠ¸ ìŠ¤ëƒ…ìƒ· 5ì¢… ì œì‘
[ ] ìœ„í—˜ì¡°ì •ìˆ˜ìµë¥  threshold íŠœë‹
```

---

## 7. ì´í›„ ë²„ì „ ì˜ˆê³  (v0.4~)

| ë²„ì „ | ì£¼ìš” ë‚´ìš© |
|--------|-----------|
| v0.4 | AI ì½”ë©˜íŠ¸ ìƒì„± ("ì´ ë¬¼ê±´ì€ ë ˆë²„ë¦¬ì§€ íš¨ê³¼ê°€ í½ë‹ˆë‹¤") |
| v0.5 | ê·¸ë˜í”„í˜• ëŒ€ì‹œë³´ë“œ (Chart.js ì ìš©) |
| v1.0 | ì¸ì‡„ìš© PDF ë¦¬í¬íŠ¸ ìƒì„± ê¸°ëŠ¥ |

---

âœ… **v0.3 ìˆ˜ìµë¶„ì„ ì—”ì§„ + ë¦¬í¬íŠ¸ ì„¤ê³„ ë¬¸ì„œ ì™„ë£Œ**  
â†’ ë‹¤ìŒ ë‹¨ê³„ëŠ”:  
```
1) profit-engine.ts ìƒì„±
2) auction-engine.ts í†µí•© íŒ¨ì¹˜
3) ProfitAnalysisReport UI ë¼ˆëŒ€ ìƒì„±
```

